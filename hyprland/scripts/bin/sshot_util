#!/usr/bin/env bash

# Defaults
method="all"
output="$HOME/documents/photos/.screenshot.png"
file=1
save=1
clip=1
notify=1

while [[ "$#" -gt 0 ]]; do
    case "$1" in
        -s | -r | --select-region)
            method="region"
            ;;
        #-w | --window)
        #    method="window"
        #    ;;
        -c | --clipboard-only)
            save=0
            ;;
        -f | --file-only)
            clip=0
            ;;
        -q | --quiet | --silent )
            notify=0
            ;;
        *)
            output="$1"
            ;;
    esac
    shift
done

sshot() {
    if [[ $method == "region" ]]; then
        grim -g "$(slurp)" $@
    else
        grim $@
    fi
}

if [[ $file -eq 0 ]]; then
    echo
    sshot - | wl-copy --type image/png
else
    echo here
    sshot $output
    [[ $clip -eq 1 ]] && wl-copy --type image/png < $output
fi

if [[ $notify -eq 1 ]]; then
    if [[ $clip -eq 1 ]] && [[ $file -eq 1 ]]; then
        message="Image copied to clipboard and saved in <i>$output</i>."
    elif [[ $clip -eq 1 ]]; then
        message="Image copied to clipboard"
    else
        message="Image saved in <i>$output</i>."
    fi

    res=$(notify-send "Screenshot saved" \
                "${message}" \
                -t 5000 -i "$output" -a Screenshot \
                --action default=x)

    if [[ $res = default ]]; then
        xdg-open $output
    fi
fi

echo done

exit 0
